<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="pageTitle">视频帧提取器 - 科技工具</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        /* Custom scrollbar styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 */
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #0d0d1a; /* Very dark blue-gray base for particles background */
            overflow-x: hidden; /* Prevent horizontal scrollbar */
            position: relative; /* Needed for z-index context */
        }

        /* particles.js container styles */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1; /* Ensure it's behind content */
            background-color: #0d0d1a; /* Match body background for seamless transition */
        }

        /* Main content container for semi-transparency */
        main {
            position: relative; /* Ensure main content is above particles */
            z-index: 1;
            background-color: rgba(31, 41, 55, 0.7); /* gray-800 with transparency */
            backdrop-filter: blur(4px); /* Optional: blur effect for content behind */
            -webkit-backdrop-filter: blur(4px);
        }

        /* Frame wrapper custom styles */
        .frame-wrapper {
            position: relative;
            cursor: pointer;
            border: 2px solid #4b5563; /* gray-600 */
            border-radius: 0.5rem; /* rounded-md */
            overflow: hidden;
            transition: all 0.2s ease-in-out;
            background-color: #374151; /* gray-700 */
        }
        .frame-wrapper:hover {
            border-color: #6366f1; /* indigo-500 */
            transform: scale(1.03);
        }
        .frame-wrapper[data-selected="true"] {
            border-color: #4f46e5; /* indigo-600 */
            border-width: 3px; /* Slightly thicker for selected */
            box-shadow: 0 0 15px rgba(79, 70, 229, 0.5);
        }
        .frame-wrapper[data-selected="true"] .selection-indicator {
            opacity: 1;
            transform: scale(1);
        }

        .selection-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 1.75rem; /* w-7 */
            height: 1.75rem; /* h-7 */
            background-color: #4f46e5; /* indigo-600 */
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s ease-in-out;
        }

        .time-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: #c7d2fe; /* indigo-200 */
            font-size: 0.75rem; /* text-xs */
            padding: 0.25rem 0.5rem;
            text-align: center;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        .frame-wrapper:hover .time-overlay {
            opacity: 1;
        }

        /* Loading overlay styles */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.8); /* gray-900 with opacity */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem; /* text-xl */
            z-index: 1000;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease-out forwards;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #818cf8; /* indigo-400 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Button base styles */
        .btn {
            padding: 0.75rem 1.5rem; /* py-3 px-6 */
            border-radius: 0.5rem; /* rounded-lg */
            font-weight: 600; /* semibold */
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border: 1px solid transparent;
        }
        .btn:hover {
            transform: translateY(-1px);
        }
        .btn:active {
            transform: translateY(0px);
        }
        .btn-primary {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca; /* indigo-700 */
        }
        .btn-secondary {
            background-color: #4b5563; /* gray-600 */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #374151; /* gray-700 */
        }
        .btn-danger {
            background-color: #dc2626; /* red-600 */
            color: white;
        }
        .btn-danger:hover {
            background-color: #b91c1c; /* red-700 */
        }
        .btn-success {
            background-color: #16a34a; /* green-600 */
            color: white;
        }
        .btn-success:hover {
            background-color: #15803d; /* green-700 */
        }
        .btn-teal {
            background-color: #0d9488; /* teal-600 */
            color: white;
        }
        .btn-teal:hover {
            background-color: #0f766e; /* teal-700 */
        }
        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
            transform: none !important;
        }
        .btn svg {
            margin-right: 0.5rem; /* mr-2 */
        }

        .language-toggle button {
            padding: 0.5rem 1rem;
            border-radius: 9999px; /* rounded-full */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* medium */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            color: #9ca3af; /* gray-400 */
        }
        .language-toggle button.active {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
        }
        .language-toggle button:not(.active):hover {
            background-color: #374151; /* gray-700 */
            color: #e5e7eb; /* gray-200 */
        }


        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.8); /* gray-900 with opacity */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: #1f2937; /* gray-800 */
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-lg */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 450px;
            width: 90%;
            color: #d1d5db; /* gray-300 */
            border: 1px solid #374151; /* gray-700 */
        }

        /* Drag and Drop styles */
        .drop-zone {
            border: 2px dashed #6366f1; /* Indigo-500 dashed border */
            background-color: #1a202c; /* Darker background for drop zone */
            transition: all 0.3s ease-in-out;
        }
        .drop-zone.drag-over {
            border-color: #818cf8; /* Light blue on drag over */
            background-color: #2d3748; /* Slightly lighter background */
            box-shadow: 0 0 25px rgba(129, 140, 248, 0.6); /* Glow effect */
        }

        /* Donation Scroll Animation */
        #donorsScrollContent {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            /* Removed animation property here, will be set dynamically by JS */
        }
        .donor-item {
            padding: 0.25rem 0;
            font-size: 0.875rem; /* text-sm */
            color: #9ca3af; /* gray-400 */
            white-space: nowrap; /* Prevent text wrapping */
            overflow: hidden;
            text-overflow: ellipsis; /* Add ellipsis if text is too long */
            height: 24px; /* Fixed height for each item to ensure consistent scrolling */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .donor-item span {
            color: #c7d2fe; /* indigo-200 for names and amounts */
            font-weight: 500;
        }
        .donor-item .time {
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* gray-500 */
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-start font-sans text-gray-200 p-4 md:p-8">
    
    <div id="particles-js"></div>

    <header class="w-full max-w-6xl mx-auto mb-8 flex justify-between items-center py-4 px-2">
        <h1 class="text-3xl md:text-4xl font-bold text-indigo-400">
            <span class="text-purple-400" data-lang-key="titlePart1">视频帧</span><span data-lang-key="titlePart2">提取器</span>
        </h1>
        <div class="language-toggle flex bg-gray-800 rounded-full p-1 shadow-md">
            <button id="lang-zh" class="active" data-lang="zh">中文</button>
            <button id="lang-en" data-lang="en">English</button>
        </div>
    </header>

    <main class="bg-gray-800 p-6 md:p-10 rounded-xl shadow-2xl w-full max-w-6xl space-y-8 border border-gray-700">
        
        <section id="upload-section" class="space-y-6">
            <div class="flex flex-col items-center space-y-4">
                <label for="videoInput" id="selectVideoLabel" class="btn btn-primary cursor-pointer shadow-lg hover:shadow-indigo-500/50">
                    <input type="file" id="videoInput" accept="video/*" class="hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                    <span data-lang-key="selectVideoFile">选择视频文件</span>
                </label>
                <span id="fileName" class="text-sm text-gray-400" data-lang-key="noFileSelected">未选择文件</span>
            </div>

            <div id="dropZone" class="w-full aspect-video bg-gray-900 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-600 hover:border-indigo-500 transition-colors duration-200">
                <video id="videoPlayer" controls class="w-full h-full object-contain hidden"></video>
                <div id="noVideoMessage" class="text-center text-gray-500 p-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-3 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                    </svg>
                    <p class="text-lg font-semibold" data-lang-key="pleaseSelectVideo">请选择或拖放视频文件</p>
                    <p class="text-xs text-gray-600" data-lang-key="dragDropHint">将视频文件拖拽到此区域即可上传</p>
                </div>
            </div>
        </section>

        <section id="controls-section" class="space-y-6 border-t border-gray-700 pt-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-end">
                <div class="space-y-2">
                    <label for="intervalInput" class="block text-sm font-medium text-gray-300" data-lang-key="intervalSeconds">提取间隔 (秒):</label>
                    <input type="number" id="intervalInput" value="1" min="0.1" step="0.1" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white">
                </div>
                <button id="extractIntervalFramesBtn" class="btn bg-purple-600 hover:bg-purple-700 btn-disabled" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 2v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span data-lang-key="extractIntervalFrames">按间隔提取帧</span>
                </button>
                 <button id="extractCurrentFrameBtn" class="btn btn-success btn-disabled" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span data-lang-key="extractCurrentFrame">提取当前帧</span>
                </button>
            </div>
             <div class="flex flex-wrap gap-4 justify-center pt-4 border-t border-gray-700">
                <button id="extractFirstLastBtn" class="btn btn-primary btn-disabled" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    <span data-lang-key="extractFirstLast">一键提取首尾帧</span>
                </button>
                <button id="downloadAllFramesBtn" class="btn btn-secondary btn-disabled" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    <span data-lang-key="downloadAllFrames">下载所有帧 (ZIP)</span>
                </button>
                <button id="downloadSelectedFramesBtn" class="btn btn-teal btn-disabled" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 13l3-3m0 0l3 3m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                    </svg>
                    <span data-lang-key="downloadSelectedFrames">下载选中帧</span>
                </button>
                <button id="clearFramesBtn" class="btn btn-danger btn-disabled" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    <span data-lang-key="clearFrames">清空帧</span>
                </button>
            </div>
        </section>

        <section id="frames-display-section" class="border-t border-gray-700 pt-8">
            <h3 class="text-xl font-semibold text-gray-300 mb-4" data-lang-key="extractedFramesTitle">提取的帧</h3>
            <div id="extractedFramesContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 p-4 bg-gray-900 rounded-lg min-h-[150px] max-h-96 overflow-y-auto border border-gray-700">
                </div>
        </section>

        <footer class="mt-10 pt-8 border-t border-gray-700 text-center space-y-4">
            <h2 class="text-2xl font-semibold text-indigo-400" data-lang-key="appreciationTitle">感谢您的支持！</h2>
            <p class="text-gray-400" data-lang-key="appreciationText">如果您觉得这个工具对您有帮助，请考虑赞赏支持开发者。</p>
            <div class="flex justify-center">
                <img src="wechat.png" alt="赞赏二维码" class="w-40 h-40 rounded-lg shadow-lg border-2 border-gray-600 object-contain">
            </div>

            <div class="mt-6 pt-4 border-t border-gray-700 space-y-2">
                <h3 class="text-xl font-semibold text-gray-300" data-lang-key="donorsListTitle">打赏榜</h3>
                <div id="donorsScrollContainer" class="h-6 overflow-hidden relative bg-gray-900 rounded-lg p-0 border border-gray-700">
                    <div id="donorsScrollContent" class="absolute inset-0">
                        </div>
                </div>
            </div>
        </footer>

        <canvas id="hiddenCanvas" class="hidden"></canvas>
    </main>

    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p class="text-xl font-medium tracking-wide" data-lang-key="loadingMessage">正在打包下载，请稍候...</p>
    </div>

    <div id="confirmationModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-lg font-semibold mb-3" data-lang-key="confirmTitle">确认操作</h3>
            <p class="mb-5 text-sm" data-lang-key="confirmMessage">您确定要清空所有已提取的帧吗？此操作不可撤销。</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelClearBtn" class="btn btn-secondary">
                    <span data-lang-key="confirmNo">取消</span>
                </button>
                <button id="confirmClearBtn" class="btn btn-danger">
                    <span data-lang-key="confirmYes">确定</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // UI Elements
        const videoInput = document.getElementById('videoInput');
        const fileNameSpan = document.getElementById('fileName');
        const videoPlayer = document.getElementById('videoPlayer');
        const noVideoMessage = document.getElementById('noVideoMessage');
        const extractCurrentFrameBtn = document.getElementById('extractCurrentFrameBtn');
        const intervalInput = document.getElementById('intervalInput');
        const extractIntervalFramesBtn = document.getElementById('extractIntervalFramesBtn');
        const clearFramesBtn = document.getElementById('clearFramesBtn');
        const downloadAllFramesBtn = document.getElementById('downloadAllFramesBtn');
        const downloadSelectedFramesBtn = document.getElementById('downloadSelectedFramesBtn');
        const extractFirstLastBtn = document.getElementById('extractFirstLastBtn');
        const extractedFramesContainer = document.getElementById('extractedFramesContainer');
        const hiddenCanvas = document.getElementById('hiddenCanvas');
        const ctx = hiddenCanvas.getContext('2d');
        const loadingOverlay = document.getElementById('loadingOverlay');

        const langZhBtn = document.getElementById('lang-zh');
        const langEnBtn = document.getElementById('lang-en');

        const confirmationModal = document.getElementById('confirmationModal');
        const confirmClearBtn = document.getElementById('confirmClearBtn');
        const cancelClearBtn = document.getElementById('cancelClearBtn');
        
        const dropZone = document.getElementById('dropZone');
        const selectVideoLabel = document.getElementById('selectVideoLabel'); // Get the label element


        const donorsScrollContainer = document.getElementById('donorsScrollContainer');
        const donorsScrollContent = document.getElementById('donorsScrollContent');


        // Global Variables
        let videoDuration = 0;
        let intervalExtractionTimer = null;
        let frameCounter = 0;
        
        // Translations object
        const translations = {
            zh: {
                pageTitle: '视频帧提取器 - 专业版',
                titlePart1: '视频帧',
                titlePart2: '提取器',
                selectVideoFile: '选择视频文件',
                noFileSelected: '未选择文件',
                pleaseSelectVideo: '请选择或拖放视频文件',
                dragDropHint: '将视频文件拖拽到此区域即可上传',
                extractCurrentFrame: '提取当前帧',
                intervalSeconds: '提取间隔 (秒):',
                extractIntervalFrames: '按间隔提取',
                extractFirstLast: '一键提取首尾帧',
                clearFrames: '清空帧',
                downloadAllFrames: '下载所有帧 (ZIP)',
                downloadSelectedFrames: '下载选中帧',
                extractedFramesTitle: '提取的帧',
                appreciationTitle: '感谢您的支持！',
                appreciationText: '如果您觉得这个工具对您有帮助，请考虑赞赏支持开发者。',
                loadingMessage: '正在打包下载，请稍候...',
                alertNoFrames: '没有可下载的帧。',
                alertSelectOneFrame: '请选择至少一帧进行下载。',
                alertInvalidInterval: '请输入有效的间隔时间（大于0）。',
                stopExtraction: '停止提取',
                extractionComplete: '按间隔提取帧完成。',
                downloadError: '打包下载失败，请稍后再试。',
                noVideoFile: '未加载视频文件。',
                confirmTitle: '确认操作',
                confirmMessage: '您确定要清空所有已提取的帧吗？此操作不可撤销。',
                confirmYes: '确定',
                confirmNo: '取消',
                refreshConfirm: '刷新页面将丢失所有已提取的帧。您确定要继续吗？',
                confirmNewVideoTitle: '确认选择新视频', // New
                confirmNewVideoMessage: '选择新视频将清空所有已提取的帧。您确定要继续吗？', // New
                donorsListTitle: '打赏榜'
            },
            en: {
                pageTitle: 'Video Frame Extractor - Pro',
                titlePart1: 'Video Frame',
                titlePart2: 'Extractor',
                selectVideoFile: 'Select Video File',
                noFileSelected: 'No file selected',
                pleaseSelectVideo: 'Please select or drag & drop a video file',
                dragDropHint: 'Drag and drop video files here to upload',
                extractCurrentFrame: 'Extract Current Frame',
                intervalSeconds: 'Extraction Interval (sec):',
                extractIntervalFrames: 'Extract by Interval',
                extractFirstLast: 'Extract First/Last Frame',
                clearFrames: 'Clear Frames',
                downloadAllFrames: 'Download All Frames (ZIP)',
                downloadSelectedFrames: 'Download Selected Frames',
                extractedFramesTitle: 'Extracted Frames',
                appreciationTitle: 'Thank You for Your Support!',
                appreciationText: 'If you find this tool helpful, please consider supporting the developer with a donation.',
                loadingMessage: 'Packaging for download, please wait...',
                alertNoFrames: 'No frames available for download.',
                alertSelectOneFrame: 'Please select at least one frame to download.',
                alertInvalidInterval: 'Please enter a valid interval (greater than 0).',
                stopExtraction: 'Stop Extraction',
                extractionComplete: 'Interval frame extraction complete.',
                downloadError: 'Packaging for download failed, please try again later.',
                noVideoFile: 'No video file loaded.',
                confirmTitle: 'Confirm Action',
                confirmMessage: 'Are you sure you want to clear all extracted frames? This action cannot be undone.',
                confirmYes: 'Confirm',
                confirmNo: 'Cancel',
                refreshConfirm: 'Refreshing the page will clear all extracted frames. Are you sure you want to proceed?',
                confirmNewVideoTitle: 'Confirm New Video Selection', // New
                confirmNewVideoMessage: 'Selecting a new video will clear all extracted frames. Are you sure you want to proceed?', // New
                donorsListTitle: 'Donation Leaderboard'
            }
        };

        // Mock Donation Data (AI-generated simulation)
        const mockDonationData = [
            { name: "李明", amount: "¥10.00", time: "今天 01:05" },
            { name: "王芳", amount: "¥5.00", time: "今天 07:12" },
            { name: "刘伟", amount: "¥20.00", time: "今天 08:20" },
            { name: "张丽", amount: "¥2.50", time: "今天 09:28" },
            { name: "Light", amount: "¥15.00", time: "今天 09:35" },
            { name: "杨敏", amount: "¥8.88", time: "今天 09:42" },
            { name: "黄磊", "amount": "¥30.00", time: "今天 09:50" },
            { name: "吴静", amount: "¥1.00", time: "今天 09:58" },
            { name: "周涛", amount: "¥7.77", time: "今天 10:05" },
            { name: "孙悦", amount: "¥12.34", time: "今天 10:12" }
        ];

        // Function to populate and start scrolling donors list
        let scrollInterval;
        let currentScrollIndex = 0;
        let donorItemHeight = 0; // Will be calculated dynamically

        function populateDonorsList() {
            donorsScrollContent.innerHTML = ''; // Clear existing content

            const createDonorItem = (donor) => {
                const div = document.createElement('div');
                div.classList.add('donor-item');
                div.innerHTML = `
                    <span class="font-bold">${donor.name}</span>
                    <span class="mx-1">${translations[localStorage.getItem('currentLang') || 'zh']['appreciationText'].includes('打赏') ? '打赏' : 'donated'}</span>
                    <span class="font-bold text-green-400">${donor.amount}</span>
                    <span class="time ml-2">${donor.time}</span>
                `;
                return div;
            };

            // Append original data
            mockDonationData.forEach(donor => {
                donorsScrollContent.appendChild(createDonorItem(donor));
            });

            // Append a copy of data for seamless looping (at least one full set)
            // This ensures smooth transition when looping back to the start
            mockDonationData.forEach(donor => {
                donorsScrollContent.appendChild(createDonorItem(donor));
            });
            // Add a few more copies to ensure content is taller than container for continuous scroll
            mockDonationData.forEach(donor => {
                donorsScrollContent.appendChild(createDonorItem(donor));
            });


            // Measure item height after they are added to DOM
            if (donorsScrollContent.children.length > 0) {
                donorItemHeight = donorsScrollContent.children[0].offsetHeight;
            } else {
                return; // No items to scroll
            }

            // Stop any existing scroll
            if (scrollInterval) {
                clearInterval(scrollInterval);
            }

            // If content is shorter than container, no need to scroll
            if (donorsScrollContent.scrollHeight <= donorsScrollContainer.clientHeight) {
                donorsScrollContent.style.animation = 'none';
                donorsScrollContent.style.transform = 'translateY(0)';
                return;
            }

            // Start scrolling
            currentScrollIndex = 0;
            donorsScrollContent.style.transition = 'none'; // Initially no transition for first positioning
            donorsScrollContent.style.transform = `translateY(0px)`;

            // Force reflow to apply the non-transitioned transform
            donorsScrollContent.offsetHeight; 

            // Re-enable transition for subsequent scrolls
            donorsScrollContent.style.transition = 'transform 1s ease-in-out'; 

            scrollInterval = setInterval(() => {
                currentScrollIndex++;
                // If scrolled past the original set of items, reset to start
                if (currentScrollIndex >= mockDonationData.length) {
                    currentScrollIndex = 0;
                    donorsScrollContent.style.transition = 'none'; // Remove transition for instant jump
                    donorsScrollContent.style.transform = `translateY(0px)`;
                    // Force reflow to apply the non-transitioned transform before re-enabling transition
                    donorsScrollContent.offsetHeight; 
                    donorsScrollContent.style.transition = 'transform 1s ease-in-out'; // Re-enable transition
                }
                donorsScrollContent.style.transform = `translateY(-${currentScrollIndex * donorItemHeight}px)`;
            }, 3000); // Scroll every 3 seconds (adjust as needed)
        }


        // Helper function to create a frame element and append it
        function createFrameElement(imgDataUrl, filename, time) {
            const frameWrapper = document.createElement('div');
            frameWrapper.classList.add('frame-wrapper');
            frameWrapper.setAttribute('data-selected', 'false');
            frameWrapper.setAttribute('data-img-src', imgDataUrl); 
            frameWrapper.setAttribute('data-filename', filename); 

            const imgElement = document.createElement('img');
            imgElement.src = imgDataUrl;
            imgElement.alt = `Frame at ${time.toFixed(2)}s`;
            imgElement.classList.add('w-full', 'h-auto', 'object-contain', 'rounded');

            const timeOverlay = document.createElement('div');
            timeOverlay.classList.add('time-overlay');
            timeOverlay.textContent = `${time.toFixed(2)}s`;

            const selectionIndicator = document.createElement('div');
            selectionIndicator.classList.add('selection-indicator');
            selectionIndicator.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';

            frameWrapper.appendChild(imgElement);
            frameWrapper.appendChild(timeOverlay);
            frameWrapper.appendChild(selectionIndicator);

            frameWrapper.addEventListener('click', () => {
                const isSelected = frameWrapper.getAttribute('data-selected') === 'true';
                frameWrapper.setAttribute('data-selected', !isSelected);
                updateButtonStates(); 
            });
            return frameWrapper;
        }

        // Function to set the language
        function setLanguage(lang) {
            const elements = document.querySelectorAll('[data-lang-key]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[lang][key]) {
                    if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                        element.setAttribute('placeholder', translations[lang][key]);
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
            document.title = translations[lang]['pageTitle'];
            if (videoInput.files && videoInput.files[0]) { // Check if file is selected
                fileNameSpan.textContent = videoInput.files[0].name;
            } else {
                fileNameSpan.textContent = translations[lang]['noFileSelected'];
            }
            
            langZhBtn.classList.toggle('active', lang === 'zh');
            langEnBtn.classList.toggle('active', lang === 'en');
            localStorage.setItem('currentLang', lang);

            // Update modal text specifically
            if (confirmationModal) {
                const currentLang = localStorage.getItem('currentLang') || 'zh';
                const modalTitleElement = confirmationModal.querySelector('[data-lang-key="confirmTitle"]');
                const modalMessageElement = confirmationModal.querySelector('[data-lang-key="confirmMessage"]');
                const modalYesElement = confirmationModal.querySelector('[data-lang-key="confirmYes"]');
                const modalNoElement = confirmationModal.querySelector('[data-lang-key="confirmNo"]');

                if (modalTitleElement) modalTitleElement.textContent = translations[currentLang]['confirmTitle'];
                if (modalMessageElement) modalMessageElement.textContent = translations[currentLang]['confirmMessage'];
                if (modalYesElement) modalYesElement.textContent = translations[currentLang]['confirmYes'];
                if (modalNoElement) modalNoElement.textContent = translations[currentLang]['confirmNo'];
            }
            // Re-populate donors list to update language in donor items
            populateDonorsList();
        }

        // Function to update button states (enabled/disabled)
        function updateButtonStates() {
            const hasVideo = !!videoPlayer.src && videoPlayer.readyState >= 2; // readyState 2 (HAVE_CURRENT_DATA) means video metadata is loaded
            const hasFrames = extractedFramesContainer.children.length > 0;
            const hasSelectedFrames = extractedFramesContainer.querySelectorAll('.frame-wrapper[data-selected="true"]').length > 0;

            // Ensure buttons exist before trying to access their properties
            if (extractCurrentFrameBtn) extractCurrentFrameBtn.disabled = !hasVideo;
            if (extractIntervalFramesBtn) extractIntervalFramesBtn.disabled = !hasVideo;
            if (extractFirstLastBtn) extractFirstLastBtn.disabled = !hasVideo; 
            if (clearFramesBtn) clearFramesBtn.disabled = !hasFrames;
            if (downloadAllFramesBtn) downloadAllFramesBtn.disabled = !hasFrames;
            if (downloadSelectedFramesBtn) downloadSelectedFramesBtn.disabled = !hasSelectedFrames;

            [extractCurrentFrameBtn, extractIntervalFramesBtn, extractFirstLastBtn, clearFramesBtn, downloadAllFramesBtn, downloadSelectedFramesBtn].forEach(button => {
                if (button) { 
                    button.classList.toggle('btn-disabled', button.disabled);
                }
            });
        }

        // Initial language setup and button states
        const savedLang = localStorage.getItem('currentLang') || 'zh';
        setLanguage(savedLang);
        updateButtonStates();
        window.addEventListener('load', () => {
            populateDonorsList();
            // Initialize particles.js after the window loads
            particlesJS('particles-js', {
                "particles": {
                    "number": {
                        "value": 80,
                        "density": {
                            "enable": true,
                            "value_area": 800
                        }
                    },
                    "color": {
                        "value": "#ffffff"
                    },
                    "shape": {
                        "type": "circle",
                        "stroke": {
                            "width": 0,
                            "color": "#000000"
                        },
                        "polygon": {
                            "nb_sides": 5
                        }
                    },
                    "opacity": {
                        "value": 0.5,
                        "random": false,
                        "anim": {
                            "enable": false,
                            "speed": 1,
                            "opacity_min": 0.1,
                            "sync": false
                        }
                    },
                    "size": {
                        "value": 3,
                        "random": true,
                        "anim": {
                            "enable": false,
                            "speed": 40,
                            "size_min": 0.1,
                            "sync": false
                        }
                    },
                    "line_linked": {
                        "enable": true,
                        "distance": 150,
                        "color": "#ffffff",
                        "opacity": 0.4,
                        "width": 1
                    },
                    "move": {
                        "enable": true,
                        "speed": 6,
                        "direction": "none",
                        "random": false,
                        "straight": false,
                        "out_mode": "out",
                        "bounce": false,
                        "attract": {
                            "enable": false,
                            "rotateX": 600,
                            "rotateY": 1200
                        }
                    }
                },
                "interactivity": {
                    "detect_on": "canvas",
                    "events": {
                        "onhover": {
                            "enable": true,
                            "mode": "grab" // Use grab for hover
                        },
                        "onclick": {
                            "enable": true,
                            "mode": "repulse" // Use repulse for click
                        },
                        "resize": true
                    },
                    "modes": {
                        "grab": {
                            "distance": 300, // Increased distance for a wider grab effect
                            "line_linked": {
                                "opacity": 0.8 // Make lines more visible
                            }
                        },
                        "bubble": { // Keep bubble config, but it won't be the primary hover mode now
                            "distance": 400,
                            "size": 10, // Make bubbles larger
                            "duration": 1.5,
                            "opacity": 0.8,
                            "speed": 3
                        },
                        "repulse": {
                            "distance": 200, // Increased distance for stronger repulsion
                            "duration": 0.8 // Duration of repulse animation
                        },
                        "push": {
                            "particles_nb": 15 // Push more particles
                        },
                        "remove": {
                            "particles_nb": 2
                        }
                    }
                },
                "retina_detect": true
            });
        });

        // Language toggle event listeners
        langZhBtn.addEventListener('click', () => setLanguage('zh'));
        langEnBtn.addEventListener('click', () => setLanguage('en'));

        // Handle video file selection (both input and drag-drop will funnel here)
        function processVideoSource(source) {
            let videoSource = null;
            let videoFileName = translations[localStorage.getItem('currentLang') || 'zh']['noFileSelected'];

            if (source && source.type && source.type.startsWith('video/')) {
                videoSource = URL.createObjectURL(source);
                videoFileName = source.name;
                videoPlayer.classList.remove('hidden');
                noVideoMessage.classList.add('hidden');
            } else {
                alert('请选择一个有效的视频文件。'); 
                videoPlayer.src = '';
                videoPlayer.classList.add('hidden');
                noVideoMessage.classList.remove('hidden');
                fileNameSpan.textContent = translations[localStorage.getItem('currentLang') || 'zh']['noFileSelected'];
                updateButtonStates();
                return;
            }
            
            fileNameSpan.textContent = videoFileName;
            videoPlayer.src = videoSource;
            videoPlayer.load(); 
            extractedFramesContainer.innerHTML = '';
            frameCounter = 0;
            updateButtonStates();
        }

        // Modified: videoInput change event for confirmation
        videoInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            const currentLang = localStorage.getItem('currentLang') || 'zh';

            if (!file) { // User canceled the file dialog
                console.log("File selection cancelled.");
                updateButtonStates(); 
                return;
            }

            // Check if a video is already loaded AND frames have been extracted
            if (videoPlayer.src && extractedFramesContainer.children.length > 0) {
                // Show confirmation modal
                confirmationModal.classList.remove('hidden');
                confirmationModal.querySelector('[data-lang-key="confirmTitle"]').textContent = translations[currentLang]['confirmNewVideoTitle'];
                confirmationModal.querySelector('[data-lang-key="confirmMessage"]').textContent = translations[currentLang]['confirmNewVideoMessage'];
                
                // Use temporary event listeners for modal buttons to avoid multiple bindings
                const handleConfirm = () => {
                    confirmationModal.classList.add('hidden');
                    confirmClearBtn.removeEventListener('click', handleConfirm);
                    cancelClearBtn.removeEventListener('click', handleCancel);
                    processVideoSource(file); // Process the new file
                };
                const handleCancel = () => {
                    confirmationModal.classList.add('hidden');
                    confirmClearBtn.removeEventListener('click', handleConfirm);
                    cancelClearBtn.removeEventListener('click', handleCancel);
                    // Clear the file input value so it doesn't re-trigger with the same file
                    videoInput.value = ''; // Reset file input
                    updateButtonStates(); 
                };

                confirmClearBtn.addEventListener('click', handleConfirm, { once: true }); 
                cancelClearBtn.addEventListener('click', handleCancel, { once: true }); 

            } else {
                // If no video or no frames, proceed directly to process the new file
                processVideoSource(file);
            }
        });

        // Drag and Drop functionality
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.add('border-indigo-500', 'bg-gray-700');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('border-indigo-500', 'bg-gray-700');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('border-indigo-500', 'bg-gray-700');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                const currentLang = localStorage.getItem('currentLang') || 'zh';

                // Check if a video is already loaded and frames extracted, show confirmation
                if (videoPlayer.src && extractedFramesContainer.children.length > 0) {
                    confirmationModal.classList.remove('hidden');
                    confirmationModal.querySelector('[data-lang-key="confirmTitle"]').textContent = translations[currentLang]['confirmNewVideoTitle'];
                    confirmationModal.querySelector('[data-lang-key="confirmMessage"]').textContent = translations[currentLang]['confirmNewVideoMessage'];
                    
                    const handleConfirmDrop = () => {
                        confirmationModal.classList.add('hidden');
                        confirmClearBtn.removeEventListener('click', handleConfirmDrop);
                        cancelClearBtn.removeEventListener('click', handleCancelDrop);
                        processVideoSource(file); // Process the dropped file
                    };
                    const handleCancelDrop = () => {
                        confirmationModal.classList.add('hidden');
                        confirmClearBtn.removeEventListener('click', handleConfirmDrop);
                        cancelClearBtn.removeEventListener('click', handleCancelDrop);
                        // Do not process the dropped file
                        updateButtonStates(); 
                    };

                    confirmClearBtn.addEventListener('click', handleConfirmDrop, { once: true });
                    cancelClearBtn.addEventListener('click', handleCancelDrop, { once: true });

                } else {
                    // Otherwise, process directly
                    processVideoSource(file);
                }
            }
        });

        videoPlayer.addEventListener('loadedmetadata', () => {
            videoDuration = videoPlayer.duration;
            hiddenCanvas.width = videoPlayer.videoWidth;
            hiddenCanvas.height = videoPlayer.videoHeight;
            updateButtonStates();
        });

        /**
         * Downloads frames as a ZIP file.
         * @param {Array<HTMLElement>} frameElements - An array of frame wrapper elements.
         * @param {string} zipFilename - The desired filename for the ZIP file.
         */
        async function downloadFramesAsZip(frameElements, zipFilename) {
            if (frameElements.length === 0) {
                alert(translations[localStorage.getItem('currentLang') || 'zh']['alertNoFrames']);
                return;
            }
            loadingOverlay.classList.remove('hidden');
            const zip = new JSZip();
            try {
                for (let i = 0; i < frameElements.length; i++) {
                    const frameWrapper = frameElements[i];
                    const imgDataUrl = frameWrapper.getAttribute('data-img-src');
                    const filename = frameWrapper.getAttribute('data-filename');
                    const response = await fetch(imgDataUrl);
                    const blob = await response.blob();
                    zip.file(filename, blob);
                }
                const content = await zip.generateAsync({ type: "blob" });
                saveAs(content, zipFilename);
            } catch (error) {
                console.error('打包下载时发生错误:', error);
                alert(translations[localStorage.getItem('currentLang') || 'zh']['downloadError']);
            } finally {
                loadingOverlay.classList.add('hidden');
            }
        }

        /**
         * Downloads a single image.
         * @param {string} imgDataUrl - The Data URL of the image.
         * @param {string} filename - The desired filename for the image.
         */
        function downloadSingleImage(imgDataUrl, filename) {
            fetch(imgDataUrl)
                .then(res => res.blob())
                .then(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url); // Clean up the URL object
                })
                .catch(error => console.error('下载图片时发生错误:', error));
        }

        /**
         * Extracts a frame from the video at a specific time or current time.
         * Appends the extracted frame to the DOM.
         * Returns a Promise that resolves with the created frameWrapper element.
         * @param {number | undefined} time - The time in seconds to extract the frame. If undefined, extracts current frame.
         * @returns {Promise<HTMLElement>} A promise that resolves with the created frameWrapper element.
         */
        function extractFrame(time) {
            return new Promise((resolve, reject) => {
                const currentLang = localStorage.getItem('currentLang') || 'zh';
                if (!videoPlayer.src || videoPlayer.readyState < 2) { 
                    console.error(translations[currentLang]['noVideoFile']);
                    reject(new Error(translations[currentLang]['noVideoFile']));
                    return;
                }

                const performExtraction = () => {
                    ctx.drawImage(videoPlayer, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
                    const imgDataUrl = hiddenCanvas.toDataURL('image/png');
                    frameCounter++;
                    const filename = `frame_at_${videoPlayer.currentTime.toFixed(2)}s_no_${frameCounter}.png`;
                    const frameWrapper = createFrameElement(imgDataUrl, filename, videoPlayer.currentTime);
                    extractedFramesContainer.appendChild(frameWrapper);
                    updateButtonStates();
                    resolve(frameWrapper);
                };

                if (time !== undefined && videoPlayer.currentTime !== time) {
                    videoPlayer.currentTime = time;
                    videoPlayer.addEventListener('seeked', function onSeeked() {
                        videoPlayer.removeEventListener('seeked', onSeeked);
                        performExtraction();
                    }, { once: true });
                } else {
                    performExtraction();
                }
            });
        }

        extractCurrentFrameBtn.addEventListener('click', () => {
            extractFrame(); 
        });

        extractIntervalFramesBtn.addEventListener('click', () => {
            const currentLang = localStorage.getItem('currentLang') || 'zh';
            if (!videoPlayer.src || videoPlayer.readyState < 2) {
                console.error(translations[currentLang]['noVideoFile']);
                return;
            }

            if (intervalExtractionTimer) {
                clearInterval(intervalExtractionTimer);
                intervalExtractionTimer = null;
                document.getElementById('extractIntervalFramesBtn').querySelector('span').textContent = translations[currentLang]['extractIntervalFrames'];
                console.log(translations[currentLang]['extractionComplete']);
                return; 
            }

            const interval = parseFloat(intervalInput.value);
            if (isNaN(interval) || interval <= 0) {
                alert(translations[currentLang]['alertInvalidInterval']);
                return;
            }

            document.getElementById('extractIntervalFramesBtn').querySelector('span').textContent = translations[currentLang]['stopExtraction'];
            let currentTime = 0;
            videoPlayer.currentTime = 0;

            const startExtraction = async () => { 
                if (currentTime <= videoDuration) {
                    await extractFrame(currentTime); 
                    currentTime += interval;
                } else {
                    clearInterval(intervalExtractionTimer);
                    intervalExtractionTimer = null;
                    document.getElementById('extractIntervalFramesBtn').querySelector('span').textContent = translations[currentLang]['extractIntervalFrames'];
                    console.log(translations[currentLang]['extractionComplete']);
                }
                updateButtonStates(); 
            };
            startExtraction();
            intervalExtractionTimer = setInterval(startExtraction, interval * 1000); 
        });

        extractFirstLastBtn.addEventListener('click', async () => {
            const currentLang = localStorage.getItem('currentLang') || 'zh';
            if (!videoPlayer.src || videoPlayer.readyState < 2) {
                console.error(translations[currentLang]['noVideoFile']);
                return;
            }

            loadingOverlay.classList.remove('hidden'); 

            try {
                const firstFrameElement = await extractFrame(0);
                const lastFrameElement = await extractFrame(videoDuration);

                const framesToDownload = [firstFrameElement, lastFrameElement];

                await downloadFramesAsZip(framesToDownload, '首尾帧.zip');

            } catch (error) {
                console.error('提取首尾帧并下载时发生错误:', error);
                alert(translations[currentLang]['downloadError']);
            } finally {
                loadingOverlay.classList.add('hidden'); 
                updateButtonStates(); 
            }
        });


        clearFramesBtn.addEventListener('click', () => {
            confirmationModal.classList.remove('hidden');
            const currentLang = localStorage.getItem('currentLang') || 'zh';
            const modalTitleElement = confirmationModal.querySelector('[data-lang-key="confirmTitle"]');
            const modalMessageElement = confirmationModal.querySelector('[data-lang-key="confirmMessage"]');
            const modalYesElement = confirmationModal.querySelector('[data-lang-key="confirmYes"]');
            const modalNoElement = confirmationModal.querySelector('[data-lang-key="confirmNo"]');

            if (modalTitleElement) modalTitleElement.textContent = translations[currentLang]['confirmTitle'];
            if (modalMessageElement) modalMessageElement.textContent = translations[currentLang]['confirmMessage'];
            if (modalYesElement) modalYesElement.textContent = translations[currentLang]['confirmYes'];
            if (modalNoElement) modalNoElement.textContent = translations[currentLang]['confirmNo'];
        });

        confirmClearBtn.addEventListener('click', () => {
            extractedFramesContainer.innerHTML = ''; 
            frameCounter = 0; 
            if (intervalExtractionTimer) {
                clearInterval(intervalExtractionTimer);
                intervalExtractionTimer = null;
                 const currentLang = localStorage.getItem('currentLang') || 'zh';
                document.getElementById('extractIntervalFramesBtn').querySelector('span').textContent = translations[currentLang]['extractIntervalFrames'];
            }
            confirmationModal.classList.add('hidden'); 
            updateButtonStates(); 
        });

        cancelClearBtn.addEventListener('click', () => {
            confirmationModal.classList.add('hidden'); 
        });

        downloadAllFramesBtn.addEventListener('click', () => {
            const allFrames = extractedFramesContainer.querySelectorAll('.frame-wrapper');
            downloadFramesAsZip(allFrames, '所有抽帧.zip');
        });

        downloadSelectedFramesBtn.addEventListener('click', () => {
            const selectedFrames = extractedFramesContainer.querySelectorAll('.frame-wrapper[data-selected="true"]');
            if (selectedFrames.length === 0) {
                alert(translations[localStorage.getItem('currentLang') || 'zh']['alertSelectOneFrame']);
                return;
            } else if (selectedFrames.length === 1) {
                // Download single image if only one is selected
                const frameWrapper = selectedFrames[0];
                const imgDataUrl = frameWrapper.getAttribute('data-img-src');
                const filename = frameWrapper.getAttribute('data-filename');
                downloadSingleImage(imgDataUrl, filename);
            } else {
                // Download as ZIP for multiple images
                downloadFramesAsZip(selectedFrames, '选中抽帧.zip');
            }
        });

        window.onbeforeunload = function() {
            if (extractedFramesContainer.children.length > 0) {
                return translations[localStorage.getItem('currentLang') || 'zh']['refreshConfirm'];
            }
        };
    </script>
</body>
</html>
